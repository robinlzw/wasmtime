# 能力附加背景

## 不可伪造的引用

描述能力的关键词之一是*不可伪造*的。

C 语言中的指针是可以伪造的，因为不受信任的代码可以将整数强制转换为指针，从而*伪造*访问该指针值所指向的内容。

MVP WebAssembly 没有不可伪造的引用，但我们可以使用整数作为替代，这些整数是指向一个表格的索引，该表格被保存在不受信任代码触及的范围之外。这些索引本身是可以伪造的，但最终表格才是持有实际能力的东西，而其元素是不可伪造的。通过创建一个新的索引，无法访问新资源。

当引用类型提议实现后，引用将是不可伪造的，并可能在 WASI API 层取代当前基于整数的 API。

## 静态与动态能力

我们可以描述两个层次的能力：静态和动态。

Wasm 模块的静态能力是其导入项。这些基本上声明了模块本身将能够请求的“权利”集合。但一个重要的警告是，这并不考虑可能在运行时传递给实例的能力。

Wasm 模块的动态能力是与文件描述符相关联的一组布尔值，表示个别的“权利”。这包括使用给定文件描述符读取或写入的能力。

## 文件系统规则

使用整数索引表示能力与 POSIX 相同，只是 POSIX 将这些索引称为*文件描述符*。

但一个区别是，POSIX 通常允许进程请求整个文件系统层次结构中任何文件的文件描述符，这是基于当前的安全策略授予的。这并不违反能力模型，但没有充分利用它。

CloudABI、Fuchsia 和其他基于能力的系统更倾向于利用文件系统的层次结构，要求不受信任的代码拥有目录的能力，以便访问该目录内的内容。

这样，你可以启动不受信任的代码，并在运行时给它访问特定目录的权限，而无需在文件系统或每个应用程序或每个用户的配置设置中设置权限。

有关如何在实践中实现这一点的示例，请参见[这个教程](WASI-tutorial.md)。

## 伯克利套接字规则

套接字本身并不是自然的层次结构，因此我们需要决定能力是什么样子。这是一个尚未实现的领域。

在 CloudABI 中，用户启动程序时已经创建了所需的套接字。这可能是一个起点，对于简单的情况可能足够了。

我们还预计会对此进行扩展，创建一个代表可以创建的套接字集合的能力。集合可能由允许的端口范围、允许的地址范围或允许的协议集来描述。在这种情况下，实际的套接字将在应用程序实际请求时创建。

## 其他信息

CloudABI 关于基于能力的安全操作系统的介绍提供了额外的背景信息：
[CloudABI 安全介绍](https://github.com/NuxiNL/cloudabi#capability-based-security)

Fuchsia 项目有一个关于基于能力的安全操作系统的博客文章：
[Fuchsia 能力安全](https://fuchsia.dev/fuchsia-src/concepts/filesystems/dotdot)

