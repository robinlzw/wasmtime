# 什么被认为是安全漏洞？

**如果你在阅读本页后仍然不确定你提出的问题是否是安全漏洞，请谨慎行事，将其报告为安全漏洞！**

要被视为安全漏洞，漏洞必须影响[第一层级平台或功能](./stability-tiers.md)。

当执行 Wasm 时，主机的安全性和沙箱的完整性是至关重要的。任何破坏 Wasm 执行沙箱的行为都被视为安全漏洞。

另一方面，只要它们被限制在沙箱内，与 Wasm 语义不同的执行（例如计算错误的值）就不被视为安全漏洞。这有几个值得强调的后果：

* 尽管从*主机*的角度来看是安全的，但从*Wasm 客户端*的角度来看，计算错误的值可能会导致典型的内存不安全漏洞，例如腐败其 `malloc` 的空闲列表或读取超出源级数组的末尾。

* Wasmtime 嵌入者永远不应该盲目信任来自客户端的值 - 无论客户端程序多么受信任，即使它是由嵌入者自己编写的 - 在代表客户端执行不安全操作之前，应该始终验证这些值。

在*执行* Wasm 时发生的服务拒绝（无论是源自编译的 Wasm 代码还是 Wasmtime 运行时子程序）被视为安全漏洞。例如，如果你配置 Wasmtime 使用异步[燃料](https://docs.rs/wasmtime/latest/wasmtime/struct.Config.html#method.consume_fuel)机制运行 Wasm 客户端，然后执行 Wasm 进入无限循环且永不产生，这被视为安全漏洞。

然而，在*编译* Wasm 时发生的服务拒绝不被视为安全漏洞。例如，在寄存器分配期间的无限循环不是安全漏洞。

主机的任何类型的内存不安全行为（例如使用后释放错误、越界内存访问等...）始终是安全漏洞。

### 备忘单：这个漏洞是否被认为是安全漏洞？

| 漏洞类型 | Wasm 编译时 | Wasm 执行时 |
|-------------------------|------------|------------|
| 沙箱逃逸 | -          | 是         |
| 未捕获的越界内存访问 | -          | 是         |
| 未捕获的越界表格访问 | -          | 是         |
| 未能维护 Wasm 的控制流完整性 | -          | 是         |
| 文件系统访问超出 WASI 文件系统的映射目录 | -          | 是         |
| 使用 WASI 资源而没有获得相关的 WASI 能力 | -          | 是         |
| 等等... | -          | 是         |
| 与 Wasm 语义不同（未逃逸沙箱） | -          | 否         |
| 计算错误的值 | -          | 否         |
| 引发错误的陷阱 | -          | 否         |
| 等等... | -          | 否         |
| 内存不安全 | 是         | 是         |
| 使用后释放 | 是         | 是         |
| 越界内存访问 | 是         | 是         |
| 使用未初始化的内存 | 是         | 是         |
| 等等... | 是         | 是         |
| 服务拒绝 | 否          | 是         |
| 崩溃 | 否          | 是         |
| 进程终止 | 否          | 是         |
| 不可中断的无限循环 | 否          | 是         |
| 用户控制的内存耗尽 | 否          | 是         |
| 对用户提供的输入的不受控制的递归 | 否          | 是         |
| 等等... | 否          | 是         |

请注意，我们仍然希望修复上述提到的每一个漏洞，即使它不是安全漏洞！我们感谢为非漏洞漏洞提出的问题，特别是当它们带有测试用例和重现步骤时！

---

总结：
本文讨论了在 Wasmtime 环境中哪些问题被视为安全漏洞。主要关注点是保护主机的安全性和沙箱的完整性。任何破坏 Wasm 执行沙箱的行为都被认为是安全漏洞，例如越界内存访问或违反 Wasm 控制流完整性。即使某些行为没有逃逸沙箱，如计算错误的值，也不算作安全漏洞。然而，任何在主机上的内存不安全行为，如使用后释放错误或越界内存访问，始终被视为安全漏洞。此外，服务拒绝攻击，如果在执行 Wasm 时发生，也被视为安全漏洞，但如果是在编译时发生则不是。文章最后强调，即使某些问题不是安全漏洞，也应积极修复，并鼓励报告这些问题，尤其是当它们附有测试用例和复现步骤时。
